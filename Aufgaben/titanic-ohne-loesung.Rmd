---
title: "Aufgaben mit Lösungen"
output: html_document
---

# Titanic: Machine Learning from Disaster

Wir schauen uns in diesem Beispiel einen Datensatz an, der Informationen über Passagiere der Titanic enthält. Diesen Datensatz finden sie auf [Kaggle](https://www.kaggle.com/c/titanic/data).

```{r}
library(tidyverse)
```


1) Laden Sie den Datensatz

```{r}
library(readr)
titanic <-titanic_data<-read_csv("/Users/mirko/Dropbox/UNI/Psychologie/Datenanalyse mit R/Daten/titanic.csv")
```

Der Output sollte ein `tibble` (oder Dataframe) sein. Schauen Sie sich die Daten an.

```{r}
titanic
```

2) Variablen auswählen

Wählen Sie Variablen aus, die für weitere Analysen interessant sein könnten. Zum Beispiel kann anhand dieser Daten die Überlebenswahrscheinlichkeit vorhersagt werden. Welche Variable könnten dazu nützlich sein (Sie diejenigen Variablen aussschliessen, welche Sie nicht benötigen)? 

```{r}
titanic_1 <- select(titanic,-Name)
```


3) Variablen konvertieren und recodieren

Welche Variablen sollten zu Faktoren konvertiert werden?

Pclass, Sex, Survived

Verändern Sie die Geschlechtsvariable so, dass diese `dummy-codiert` ist (1: Male, 0: Female).

Es gibt mehrere Möglichkeiten, eine davon haben wir kennengelernt (`recode()`). Eine andere Variante benutzt die Funktion `if_else()`. Schauen Sie nach, wie man diese benutzt.
 
```{r}
# 1)

titanic_2 <- titanic_1 %>% mutate(Pclass<-factor(Pclass),Sex<-factor(Sex),Survived<-factor(Survived))
```


```{r}
# 2)
titanic_2 <- titanic_1 %>% ?
```


4) Daten filtern

Filter Sie den Datensatz, so dass Sie z.B. alle Frauen unter 25 oder über 50 suchen. 

```{r}
titanic_2 %>%  filter(Sex=="female" & (Age<25 | Age>50))
```

```{r}
titanic_2 %>% ?
```


5) Daten zusammenfassen

a) Berechnen Sie den den durchschnittlichen Preis einer Fahrkarte für jeden Preiskategorie.


```{r}
fare <- titanic %>% 
      group_by(Pclass) %>%
      summarise(fare_mean <- mean(Fare))
fare
```


```{r}
library(ggplot2)
fare %>% ggplot(aes(x = Pclass, y = mean_fare)) +
  geom_bar(stat = 'identity') +
  xlab('Passenger Class') +
  ylab('Mean Fare in USD')
```


b) Berechnen Sie den den Überlebenswahrscheinlicheit nach Preiskategorie und Geschlecht.



```{r}
survival <- titanic_2 %>% 
    group_by(Pclass,Sex) %>% 
  summarise(N=length(Survived),
            survived <- sum(Survived),
            p_survived<- mean(Survived))

survival
```


6) Daten analysieren

Unser Ziel ist, die Überlebenswahrscheinlicheit vorherzusagen. Welche statistische Methode könnten Sie verwenden?

```{r}
glm(...)
```


graphische Darstellung:

```{r}
a<- switch(age,)
```





SVM
```{r}
library(e1071)
library(caret)
library(NLP)
library(tm)

titanic_1$surv<-if_else(titanic_1$Survived==1,TRUE,FALSE)
trainPositive<-subset(titanic_1,surv)
testnegative<-subset(titanic_1,surv)
inTrain<-createDataPartition(1:nrow(trainPositive),p=0.6,list=FALSE)

trainpredictors<-as.matrix(titanic_1[inTrain,c(3,5,9)])
trainLabels<-as.matrix( trainPositive[inTrain,2])

testPositive<-titanic_1[-inTrain,]
testPosNeg<-rbind(testPositive,testnegative)

testpredictors<-testPosNeg[,c(3,5,9)]
testLabels<-testPosNeg[,2]

svm.model<-svm(trainpredictors,y=NULL,
               type='one-classification',
               nu=0.01,
               scale=TRUE,
               kernel="linear")

svm.predtrain<-predict(svm.model,trainpredictors)
svm.predtest<-predict(svm.model,testpredictors)

confTrain<-table(Predicted=svm.predtrain,Reference=trainLabels)
confTest<-table(Predicted=svm.predtest,Reference=testLabels)

confusionMatrix(confTest,positive='TRUE')

print(confTrain)
print(confTest)

```


